@page
@model WebApplication1.Pages.Courses.IndexModel

@{
    ViewData["Title"] = "Courses";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<h1>Courses</h1>

<p>
    <a asp-page="Create">Create New</a>
</p>

<input type="text" id="courseSearch" class="form-control mb-2" placeholder="Search courses..." />

<table class="table" id="coursesTable">
    <thead>
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Quarter</th>
            <th>Year</th>
            <th>Teacher</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model.Course) {
        <tr>
            <td>@item.Name</td>
            <td>@item.Description</td>
            <td>@item.StartDate?.ToShortDateString()</td>
            <td>@item.EndDate?.ToShortDateString()</td>
            <td>@item.Quarter</td>
            <td>@item.Year</td>
            <td>@item.Teacher.LastName</td>
            <td>
                <a asp-page="./Edit" asp-route-id="@item.Id">Edit</a> |
                <a asp-page="./Details" asp-route-id="@item.Id">Details</a> |
                <a asp-page="./Delete" asp-route-id="@item.Id">Delete</a> |
                <a asp-page="/Courses/Assignments/Index" asp-route-courseId="@item.Id">Assignments</a>
            </td>
        </tr>
}
    </tbody>
</table>

@section Scripts {
    <script>
        // Simple client-side search
        document.getElementById('courseSearch').addEventListener('keyup', function () {
            var search = this.value.toLowerCase();
            var rows = document.querySelectorAll('#coursesTable tbody tr');
            rows.forEach(function (row) {
                var text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        });

        // Simple client-side sorting
        document.querySelectorAll('#coursesTable th').forEach(function (header, i) {
            header.style.cursor = 'pointer';
            header.addEventListener('click', function () {
                var table = header.closest('table');
                var tbody = table.querySelector('tbody');
                var rows = Array.from(tbody.querySelectorAll('tr'));
                var asc = header.asc = !header.asc;
                rows.sort(function (a, b) {
                    var cellA = a.children[i].textContent.trim().toLowerCase();
                    var cellB = b.children[i].textContent.trim().toLowerCase();
                    if (!isNaN(Date.parse(cellA)) && !isNaN(Date.parse(cellB))) {
                        return asc ? new Date(cellA) - new Date(cellB) : new Date(cellB) - new Date(cellA);
                    }
                    if (!isNaN(cellA) && !isNaN(cellB)) {
                        return asc ? cellA - cellB : cellB - cellA;
                    }
                    return asc ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
                });
                rows.forEach(row => tbody.appendChild(row));
            });
        });
    </script>
}